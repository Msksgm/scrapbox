# 0216\_「図解でなっとく! トラブル知らずのシステム設計」 読書 継続 421 日

## 第 2 部 DB 性能

### 第 4 章 インデックス・テーブル結合

DBMS は SQL を実行する際に、「解析」と「走査」という 2 段階の処理がおこなわれる。

「解析」SQL 文を解析し実行計画を作成する
「操作」実行計画に基づいてデータ探索する

解析フェーズでは 4 つの処理をおこなう

1. SQL の解釈
2. SQL の最適化
3. 実行計画の作成
4. 実行計画の決定

実行計画を見たい時には以下のようにする

MySQL、PostgreSQL の場合
EXPLAIN ステートメントを実行する

結合の種類

- Nested Loop
  - 駆動表のアクセス時間 + 内部表のアクセス時間 \* 駆動表の検索結果件数
- Merge Join
  - 両テーブルを検索した後、結合キーでそれぞれソートする。ソートした結果を用いて結合する
  - 住所テーブルのアクセス時間 + 会員テーブルのアクセス時間 + ソートの処理時間
- Hash Join
  - まず検索結果のサイズが小さいテーブルを検索し、結合キーをハッシュ値にしたハッシュ表を作る。次にサイズの大きい方のテーブルを検索し、検索結果の結合キーのハッシュ値をハッシュ表と突き合わせることで結合する
  - 住所テーブルのアクセス時間 + ハッシュ表の作成時間 + 会員テーブルのアクセス時間 + 大規模表のアクセス時間

性能面では「フルスキャン」より「インデックススキャン」
特性を抑えて効果的なインデックスを作成する
