# 0214\_「図解でなっとく! トラブル知らずのシステム設計」 読書 継続 419 日

## 第 1 部 画面設計

### 第 2 章 戻る操作

「戻る」の実装方法は 2 種類

- ブラウザ操作による戻る遷移
- アプリ制御による戻る遷移

戻り先の検討方法

- 戻り先を決める
- 子画面を作成する

要件によっては、スクロールあとの画面にもどってしまう

キャッシュなしで実装してしまうと、フォームが再送信されて、2 重登録されてしまう

キャッシュとは

- 一度インターネットから読み込んだデータをローカルのディスクに保存しておくことで、再度表示する際にはネットワークを介さず素早くデータを表示することがある
- デメリット
  - キャッシュされた情報が古くなっていると、最新情報が表示されないことになる
  - ディスク上に個人情報などが保存されてしまう

ブラウザの「戻る」により、登録処理を行なっていたリクエストが再送信されてしまう、ことに対する対 s 買う

1. 戻れなくする
2. もどっても登録されないようにする
   1. PRG パターンを使う
   2. 二重送信を抑止する
   3. セッションオブジェクトを適切なタイミングで消す

PRG パターン

1. POST で登録 ->登録画面
2. レスポンスでリダイレクト処理を指示 登録画面->完了画面
3. クライアントは、指示された通り GET リクエストを送信
4. サーバーは、HTML をレスポンスする

二重送信防止

同じリクエストが送信されたときに、処理をしないようにすること。
「トークンチェック」という方法で、2 回目の同じリクエストを無効化する。
まず「トークン」をサーバー側が発行する。そしてトークンをセッション上 g と画面側にそれぞれ持って次の処理へ移る。もどってきたら、サーバー側でトークンを突き合わせてチェックする

セッションの中身を消す
1 回目の登録処理時にセッションの中身を消してしまうことで、2 回目の登録処理はできなくなること
