# 0205\_「達人に学ぶ DB 設計徹底指南署」 読書 継続 410 日

選択条件を冗長に保持すると正規形に違反するが、検索を高速化できる

1. 非正規形は、検索のパフォーマンスは向上させるが更新のパフォーマンスを低下させる
2. データのリアルタイム性（鮮度）を低下させる
3. 後続の工程で設計変更すると、手戻りが大きい

## 第 6 章 データベースとパフォーマンス

データベースのパフォーマンスを決める要因

1. インデックス
2. 統計情報

インデックス設計

1. アプリケーションのコードに影響を与えない（アプリケーション透過的）
2. テーブルのデータに影響を与えない（データ透過的）
3. それでいて性能改善の効果が大きい

B-tree

1. 均一性:各キー値の間で検索速度にバラツキが少ない。平衡木であるため
2. 持続性:データ量の増加に比してパフォーマンス低下が少ない。計算量は O(logn)
3. 処理汎用性:検索、挿入、更新、削除のいずれの処理もそこそこ速い
4. 非等値性:等価に限らず、不統合を使ってもそこそこ速い。<>、!=以外は効果がある
5. 親ソート性:GROUP BY、ORDER BY、COUNT/MAX/MIN などなどソートが必要な処理を高速化できる。

B-tree インデックスの設計方針

指針 1 大規模なテーブルに対して作成する。データ量が少ない場合はインデックスの効果はない
指針 2 カーディナリティの高い列に作成する。到底のキー値を指定したときに、全体のレコード数の 5%程度に絞り込めるだけのカーディナリティがあること
指針 3 SQL 文で WHERE 句の選択条件、または結合条件に使用されている列に作成する

インデックスを利用できていない計算

1. 乗算
2. 関数
3. IS NULL 述語
4. 否定形
5. OR を用いている
6. 後方一致、または中間一致の LIKE 述語を用いている
7. 暗黙の型変換をおこなっている

注意事項

- 主キーおよび一意制約の列には作成不要
- B-tree インデックスは更新性能を劣化させる
- 定期的なメンテナンスを行うことが望ましい

統計情報

オプティマイザと実行計画

1. SQL 文が DBMS へ発行され、パーサが解析する
2. オプティマイザが実行計画を決める
3. オプティマイザがカタログマネージャに統計情報の照会をかける
4. カタログマネージャが返す
5. 統計情報から、最短と思われる SQL を手続きに変換する

統計情報の設計指針

データが大きく更新された後、なるべく早く

統計情報収集は原則、夜間帯に実施する
