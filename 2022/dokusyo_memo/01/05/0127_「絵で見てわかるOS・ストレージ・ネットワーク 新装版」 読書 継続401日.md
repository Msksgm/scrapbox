# 0127\_「絵で見てわかる OS・ストレージ・ネットワーク 新装版」 読書 継続 401 日

OLTP（On-Line Transaction Processing）

プロセスとスレッドは実行の単位
アプリ・DBMS「劇」、OS「劇場」、プロセス「舞台」、スレッド「役者」

生成、実行可能、実行、スリープ、ゾンビ

CPU 使用率の内訳
３つの状態（SYS、USER、IDLE）

プロセスの状態をコンテキストと呼ぶ->舞台

コネクションプーリング

データベースのコネクションをプーリングし（いくつかキープしておいて）、必要なときに、必要なアプリケーションを使用する。OS にとってコストのかかる「プロセスやスレッドの生成処理」を行う必要がなくなる

CPU の使用率に閾値をもうける理由 1.問題が発生する前に具体的な対策をするため、2.「遅くなる」という問題に対応するため
CPU が応答は、行列が発生している時間と発生していない時間の両方を含めて、待ち行列の数の平均を算出しているため

CPU 技術の進化とアプリケーションや DBMS との関係を探る
仮想化技術とそのメリット・デメリット

- ハイパーバイザー型（Xen、KVM、Hyper-V など）
  - １つのハードウェアで複数の仮想マシンとして稼働させる
  - ハードウェアレベルで仮想化をする
  - Linux、Window といった異なる複数の OS を仮想マシンとして稼働させることができる
  - 仮想マシンにゲスト OS を含むため、マシンイメージのサイズが大きかったり、オーバヘッドが発生する
- コンテナ型
  - コンテナと呼ばれる単位で複数の仮想的なユーザー空間を提供する
  - OS レベルで仮想化をする
  - オーバヘッドが少ない
  - ホスト OS と異なる OS を動かすことができない

OS が行うスケジューリング
実行順序にしたがって、CPU を横取りすること
処理の順序付けするのが「実行順序の制御」

CPU 使用率が高い場合にアプリケーションや DB 側で何ができる？
アルゴリズムしだい
アクセスするブロッグ数が増える、処理の量が増える、CPU を消費する
DBMS のインデックスは、見る必要のあるデータ量が減るため、アクセスするブロック数が減る

アプリケーションや DB サーバーの性能はマルコア化で向上するか？
基本的には「YES」。ただし、さまざまな条件が必要
アプリケーションや DBMS の性能はレスポンスタイムとスループットに分けて考える
レスポンスは、CPU が不足していない限りあがらない。コアが増えてもクロック数が上がらないがキリスピードはあがらない
スループットは、OLTP 系処理で CPU が不足しているのなら、CPU の待ち行列が解消されて快適になる
OLTP 系で、DBMS がスケーラブルになるように作られていないと、意味がない

今後 CPU はどうなるのか
Web 系や OLTP 系システムなどの並列処理が可能なシステムでは、マルチコア化によってスループット性能が上がる

まとめ
DBMS だけではなく、OS の動きやアプリケーションからのリクエストの処理を考えないと処理性能はわからない、
現場で DBMS の分析・チューニングを行う際には、OS まで含めた動作を思い描くこと。一度では無理でも、繰り返せば必ずよりよモデルが思い描けるようになり、さらに応用の利くスキルが得られる
